{% extends "base.html" %}

{% block content %}
<div class="container">
    <h2 class="text-2xl font-semibold mb-6">Configuration des points d'entrée pour {{ endpoint.name }}</h2>

    <div class="grid gap-6 md:grid-cols-2">
        <!-- Configuration MLLP -->
        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-medium">Points d'entrée MLLP</h3>
                <a href="/endpoints/{{ endpoint.id }}/mllp/new" 
                   class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                    Nouveau point MLLP
                </a>
            </div>

            {% if mllp_configs %}
            <div class="space-y-4">
                {% for config in mllp_configs %}
                <div class="border rounded-lg p-4 hover:bg-slate-50">
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-medium">{{ config.name }}</h4>
                        <span class="text-sm px-2 py-1 rounded-full {% if config.is_enabled %}bg-green-100 text-green-800{% else %}bg-red-100 text-red-800{% endif %}">
                            {{ "Actif" if config.is_enabled else "Inactif" }}
                        </span>
                    </div>
                    <div class="text-sm text-slate-600 space-y-1">
                        <p>Port: {{ config.port }}</p>
                        <p>App: {{ config.sending_app }}</p>
                        <p>Facility: {{ config.sending_facility }}</p>
                    </div>
                    <div class="mt-3 flex gap-2">
                        <a href="/endpoints/{{ endpoint.id }}/mllp/{{ config.id }}/edit" class="text-blue-600 hover:underline">Modifier</a>
                        <form method="POST" action="/endpoints/{{ endpoint.id }}/mllp/{{ config.id }}/toggle" class="inline">
                            <button type="submit" class="text-slate-600 hover:underline">
                                {{ "Désactiver" if config.is_enabled else "Activer" }}
                            </button>
                        </form>
                        <form method="POST" action="/endpoints/{{ endpoint.id }}/mllp/{{ config.id }}/delete" 
                              class="inline"
                              onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer ce point MLLP ?')">
                            <button type="submit" class="text-red-600 hover:underline">Supprimer</button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-slate-600">Aucun point MLLP configuré</p>
            {% endif %}
        </div>

        <!-- Configuration FHIR -->
        <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-medium">Points d'entrée FHIR</h3>
                <a href="/endpoints/{{ endpoint.id }}/fhir/new"
                   class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                    Nouveau point FHIR
                </a>
            </div>

            {% if fhir_configs %}
            <div class="space-y-4">
                {% for config in fhir_configs %}
                <div class="border rounded-lg p-4 hover:bg-slate-50">
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-medium">{{ config.name }}</h4>
                        <span class="text-sm px-2 py-1 rounded-full {% if config.is_enabled %}bg-green-100 text-green-800{% else %}bg-red-100 text-red-800{% endif %}">
                            {{ "Actif" if config.is_enabled else "Inactif" }}
                        </span>
                    </div>
                    <div class="text-sm text-slate-600 space-y-1">
                        <p>URL: {{ config.base_url }}{{ config.path_prefix }}</p>
                        <p>Version: {{ config.version }}</p>
                        <p>Auth: {{ config.auth_kind }}</p>
                    </div>
                    <div class="mt-3 flex gap-2">
                        <a href="/endpoints/{{ endpoint.id }}/fhir/{{ config.id }}/edit" class="text-blue-600 hover:underline">Modifier</a>
                        <form method="POST" action="/endpoints/{{ endpoint.id }}/fhir/{{ config.id }}/toggle" class="inline">
                            <button type="submit" class="text-slate-600 hover:underline">
                                {{ "Désactiver" if config.is_enabled else "Activer" }}
                            </button>
                        </form>
                        <form method="POST" action="/endpoints/{{ endpoint.id }}/fhir/{{ config.id }}/delete"
                              class="inline" 
                              onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer ce point FHIR ?')">
                            <button type="submit" class="text-red-600 hover:underline">Supprimer</button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-slate-600">Aucun point FHIR configuré</p>
            {% endif %}
        </div>
    </div>

    <div class="mt-6">
        <a href="/endpoints/{{ endpoint.id }}" class="text-slate-600 hover:underline">
            ← Retour aux détails de l'endpoint
        </a>
    </div>
</div>
{% endblock %}