{% extends "base.html" %}
{% import "components.html" as components %}

{% block content %}
<div class="container">
    <div class="my-8">
        <h1 class="text-3xl font-bold mb-6">
            {% if namespace %}Modifier{% else %}Nouvel{% endif %} espace de noms
        </h1>

        <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <form method="POST" action="{% if namespace %}/admin/ght/{{ context.id }}/namespaces/{{ namespace.id }}/edit{% else %}/admin/ght/{{ context.id }}/namespaces/new{% endif %}">
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-slate-700">Nom</label>
                        <input type="text" name="name" value="{{ namespace.name if namespace else '' }}" required
                               class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        <p class="mt-1 text-sm text-slate-500">Nom descriptif (ex: "IPP EJ Principal")</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-700">URI du système</label>
                        <input type="text" name="system" value="{{ namespace.system if namespace else '' }}" required
                               pattern="[a-zA-Z][a-zA-Z0-9\-\._:]+[a-zA-Z0-9]+"
                               class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        <p class="mt-1 text-sm text-slate-500">URI unique (ex: "urn:oid:1.2.250.1.71.1.2.2")</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-700">OID</label>
                        <input type="text" name="oid" value="{{ namespace.oid if namespace else '' }}"
                               pattern="[0-9]+(\.[0-9]+)*"
                               class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        <p class="mt-1 text-sm text-slate-500">OID si différent de l'URI (ex: "1.2.250.1.71.1.2.2")</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-700">Type</label>
                        <select name="type" required
                                class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            <option value="PI" {% if not namespace or namespace.type == 'PI' %}selected{% endif %}>Patient Interne (PI)</option>
                            <option value="VN" {% if namespace and namespace.type == 'VN' %}selected{% endif %}>Visite/Venue (VN)</option>
                            <option value="XX" {% if namespace and namespace.type == 'XX' %}selected{% endif %}>Organisation (XX)</option>
                            <option value="RI" {% if namespace and namespace.type == 'RI' %}selected{% endif %}>Resource ID (RI)</option>
                        </select>
                        <p class="mt-1 text-sm text-slate-500">Type d'identifiant selon HL7</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-700">Description</label>
                        <textarea name="description" rows="3"
                                  class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">{{ namespace.description if namespace else '' }}</textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-700">État</label>
                        <select name="is_active"
                                class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            <option value="true" {% if not namespace or namespace.is_active %}selected{% endif %}>Actif</option>
                            <option value="false" {% if namespace and not namespace.is_active %}selected{% endif %}>Inactif</option>
                        </select>
                    </div>

                    <div class="flex justify-end gap-4">
                        <a href="/admin/ght/{{ context.id }}" 
                           class="px-4 py-2 text-slate-600 hover:text-slate-800">
                            Annuler
                        </a>
                        <button type="submit" 
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            {% if namespace %}Mettre à jour{% else %}Créer{% endif %}
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}