{# Breadcrumb #}
{% macro breadcrumb(items) %}
<nav class="flex items-center space-x-2 text-sm text-slate-600 mb-6" aria-label="Fil d'Ariane">
  <a href="/" class="hover:text-blue-600">
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
    </svg>
  </a>
  {% for item in items %}
    <svg class="w-5 h-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
    </svg>
    {% if loop.last %}
      <span class="font-medium text-slate-900">{{ item.label }}</span>
    {% else %}
      <a href="{{ item.url }}" class="hover:text-blue-600">{{ item.label }}</a>
    {% endif %}
  {% endfor %}
</nav>
{% endmacro %}

{# Menu d'actions #}
{% macro actions_menu(actions, open_by_default=False) %}
<details class="relative" {% if open_by_default %}open{% endif %}>
  <summary class="list-none inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-slate-700 bg-white border border-slate-300 rounded-xl hover:bg-slate-50 cursor-pointer select-none">
    <span>Actions</span>
    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
    </svg>
  </summary>
  <div class="absolute right-0 mt-2 w-48 bg-white border border-slate-200 rounded-xl shadow-lg z-50">
    {% for action in actions %}
      {% if action.type == 'link' %}
        <a href="{{ action.url }}" class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-50 first:rounded-t-xl last:rounded-b-xl">
          {{ action.label }}
        </a>
      {% elif action.type == 'button' %}
        <form method="post" action="{{ action.url }}" class="block">
          <button type="submit" class="w-full px-4 py-2 text-sm text-left text-slate-700 hover:bg-slate-50 first:rounded-t-xl last:rounded-b-xl">
            {{ action.label }}
          </button>
        </form>
      {% endif %}
    {% endfor %}
  </div>
</details>
{% endmacro %}

{# Generic form field helper: label + input/select/textarea with id/for and help text #}
{% macro form_field(label, name, type='text', value='', required=False, help=None, options=None, rows=3) %}
<div>
  <label class="block text-sm font-medium text-slate-700" for="{{ name }}">{{ label }}{% if required %} <span class="text-red-500">*</span>{% endif %}</label>
  {% if type == 'textarea' %}
    <textarea id="{{ name }}" name="{{ name }}" rows="{{ rows }}" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">{{ value }}</textarea>
  {% elif type == 'select' %}
    <select id="{{ name }}" name="{{ name }}" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
      {% for opt in options %}
        <option value="{{ opt.value }}" {% if opt.value == value %}selected{% endif %}>{{ opt.label }}</option>
      {% endfor %}
    </select>
  {% else %}
    <input id="{{ name }}" name="{{ name }}" type="{{ type }}" value="{{ value }}" {% if required %}required{% endif %} class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
  {% endif %}
  {% if help %}
    <p class="mt-1 text-sm text-slate-500">{{ help }}</p>
  {% endif %}
</div>
{% endmacro %}

{# Filtre de recherche #}
{% macro search_filter(filters, base_url='') %}
<div class="bg-white p-4 rounded-xl border border-slate-200 mb-6">
  <form method="get" class="grid grid-cols-1 md:grid-cols-3 gap-4">
    {% for filter in filters %}
      <div>
        <label class="block text-sm font-medium text-slate-700 mb-1">
          {{ filter.label }}
        </label>
        {% if filter.type == 'text' %}
          <input
            type="text"
            name="{{ filter.name }}"
            value="{{ filter.value }}"
            placeholder="{{ filter.placeholder }}"
            class="w-full rounded-lg border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
          >
        {% elif filter.type == 'select' %}
          <select
            name="{{ filter.name }}"
            class="w-full rounded-lg border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
          >
            <option value="">{{ filter.placeholder }}</option>
            {% for opt in filter.options %}
              <option value="{{ opt.value }}" {% if opt.value == filter.value %}selected{% endif %}>
                {{ opt.label }}
              </option>
            {% endfor %}
          </select>
        {% endif %}
      </div>
    {% endfor %}
    <div class="md:col-span-3 flex justify-end gap-3">
      <a 
        href="{{ base_url }}"
        class="px-4 py-2 text-sm font-medium text-slate-700 bg-white border border-slate-300 rounded-lg hover:bg-slate-50"
      >
        Réinitialiser
      </a>
      <button 
        type="submit"
        class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700"
      >
        Appliquer les filtres
      </button>
    </div>
  </form>
</div>
{% endmacro %}

{# Pagination #}
{% macro pagination(current_page, total_pages, base_url) %}
{% if total_pages > 1 %}
<div class="flex items-center justify-between px-4 py-3 border-t border-slate-200 bg-white">
  <div class="flex items-center gap-2">
    <p class="text-sm text-slate-700">
      Page <span class="font-medium">{{ current_page }}</span> sur <span class="font-medium">{{ total_pages }}</span>
    </p>
  </div>
  <div class="flex items-center gap-2">
    {% if current_page > 1 %}
      <a 
        href="{{ base_url }}?page={{ current_page - 1 }}"
        class="px-3 py-1 text-sm font-medium text-slate-700 bg-white border border-slate-300 rounded hover:bg-slate-50"
      >
        Précédent
      </a>
    {% endif %}
    
    {% for p in range(1, total_pages + 1) %}
      {% if p == current_page %}
        <span class="px-3 py-1 text-sm font-medium text-white bg-blue-600 rounded">
          {{ p }}
        </span>
      {% else %}
        <a 
          href="{{ base_url }}?page={{ p }}"
          class="px-3 py-1 text-sm font-medium text-slate-700 bg-white border border-slate-300 rounded hover:bg-slate-50"
        >
          {{ p }}
        </a>
      {% endif %}
    {% endfor %}

    {% if current_page < total_pages %}
      <a 
        href="{{ base_url }}?page={{ current_page + 1 }}"
        class="px-3 py-1 text-sm font-medium text-slate-700 bg-white border border-slate-300 rounded hover:bg-slate-50"
      >
        Suivant
      </a>
    {% endif %}
  </div>
</div>
{% endif %}
{% endmacro %}

{# Badge d'état #}
{% macro status_badge(status, label=None) %}
{% set colors = {
  'active': 'bg-green-100 text-green-800',
  'inactive': 'bg-slate-100 text-slate-800',
  'pending': 'bg-yellow-100 text-yellow-800',
  'error': 'bg-red-100 text-red-800',
  'success': 'bg-green-100 text-green-800',
  'warning': 'bg-yellow-100 text-yellow-800',
  'info': 'bg-blue-100 text-blue-800'
} %}
<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium {{ colors[status] }}">
  {{ label if label else status|title }}
</span>
{% endmacro %}

{# Carte d'aperçu #}
{% macro preview_card(title, content, footer=None, image_url=None) %}
<div class="bg-white rounded-xl border border-slate-200 overflow-hidden">
  {% if image_url %}
    <img src="{{ image_url }}" alt="" class="w-full h-32 object-cover">
  {% endif %}
  <div class="p-4">
    <h3 class="text-lg font-medium text-slate-900 mb-2">{{ title }}</h3>
    <div class="text-sm text-slate-600">{{ content }}</div>
    {% if footer %}
      <div class="mt-4 pt-4 border-t border-slate-200">
        {{ footer }}
      </div>
    {% endif %}
  </div>
</div>
{% endmacro %}

{# Message d'alerte #}
{% macro alert(type, message) %}
{% set styles = {
  'info': 'bg-blue-50 border-blue-200 text-blue-800',
  'success': 'bg-green-50 border-green-200 text-green-800',
  'warning': 'bg-yellow-50 border-yellow-200 text-yellow-800',
  'error': 'bg-red-50 border-red-200 text-red-800'
} %}
<div class="p-4 rounded-xl border {{ styles[type] }}">
  <div class="flex items-center gap-3">
    {% if type == 'info' %}
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    {% elif type == 'success' %}
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    {% elif type == 'warning' %}
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
      </svg>
    {% elif type == 'error' %}
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    {% endif %}
    <span>{{ message }}</span>
  </div>
</div>
{% endmacro %}

{# Modal de confirmation #}
{% macro confirm_modal(id, title, content, confirm_text='Confirmer', cancel_text='Annuler') %}
<div 
  x-data="{ open: false }"
  x-show="open"
  x-on:{{ id }}.window="open = true"
  class="fixed inset-0 z-50 overflow-y-auto"
  style="display: none;"
>
  <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center">
    <div 
      class="fixed inset-0 transition-opacity bg-slate-500 bg-opacity-75"
      x-show="open"
      x-transition:enter="ease-out duration-300"
      x-transition:enter-start="opacity-0"
      x-transition:enter-end="opacity-100"
      x-transition:leave="ease-in duration-200"
      x-transition:leave-start="opacity-100"
      x-transition:leave-end="opacity-0"
    ></div>

    <div 
      class="inline-block w-full max-w-md p-6 my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-2xl"
      x-show="open"
      x-transition:enter="ease-out duration-300"
      x-transition:enter-start="opacity-0 translate-y-4"
      x-transition:enter-end="opacity-100 translate-y-0"
      x-transition:leave="ease-in duration-200"
      x-transition:leave-start="opacity-100 translate-y-0"
      x-transition:leave-end="opacity-0 translate-y-4"
    >
      <h3 class="text-lg font-medium leading-6 text-slate-900 mb-4">
        {{ title }}
      </h3>
      <div class="mt-2">
        <p class="text-sm text-slate-600">
          {{ content }}
        </p>
      </div>
      <div class="mt-6 flex justify-end gap-3">
        <button
          type="button"
          @click="open = false"
          class="px-4 py-2 text-sm font-medium text-slate-700 bg-white border border-slate-300 rounded-lg hover:bg-slate-50"
        >
          {{ cancel_text }}
        </button>
        <button
          type="button"
          @click="$dispatch('confirm-{{ id }}'); open = false"
          class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700"
        >
          {{ confirm_text }}
        </button>
      </div>
    </div>
  </div>
</div>
{% endmacro %}