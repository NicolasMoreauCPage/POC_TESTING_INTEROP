{% extends "base.html" %}

{% block content %}
<section class="space-y-6">
  <header class="flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
    <div>
      <h2 class="text-2xl font-semibold text-slate-800">GHT {{ ght_context.name }}</h2>
      <p class="text-sm text-slate-500">Code : {{ ght_context.code }} — Tableau de bord des activités</p>
    </div>
    <div class="flex gap-2 text-xs">
      <a href="/admin/ght" class="inline-flex items-center gap-2 rounded-full border border-slate-200 px-3 py-1.5 text-slate-600 hover:bg-slate-100">
        Changer de GHT
      </a>
      <a href="/messages" class="inline-flex items-center gap-2 rounded-full bg-blue-600 px-3 py-1.5 text-white hover:bg-blue-700">
        Messages récents
      </a>
    </div>
  </header>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-5">
    <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">
      <p class="text-sm text-slate-500">Patients</p>
      <p class="mt-2 text-3xl font-semibold text-slate-800">{{ stats.patients }}</p>
      <a href="/patients" class="mt-4 inline-flex text-xs text-blue-600 hover:underline">Voir la liste</a>
    </div>
    <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">
      <p class="text-sm text-slate-500">Dossiers</p>
      <p class="mt-2 text-3xl font-semibold text-slate-800">{{ stats.dossiers }}</p>
      <a href="/dossiers" class="mt-4 inline-flex text-xs text-blue-600 hover:underline">Voir la liste</a>
    </div>
    <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">
      <p class="text-sm text-slate-500">Venues</p>
      <p class="mt-2 text-3xl font-semibold text-slate-800">{{ stats.venues }}</p>
      <a href="/venues" class="mt-4 inline-flex text-xs text-blue-600 hover:underline">Voir la liste</a>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">
      <h3 class="text-base font-semibold text-slate-800">Actions rapides</h3>
      <div class="mt-4 grid gap-3 text-sm">
        <a href="/structure" class="rounded-xl border border-slate-200 px-3 py-2 hover:bg-blue-50">Structure hospitalière</a>
        <a href="/messages/send" class="rounded-xl border border-slate-200 px-3 py-2 hover:bg-blue-50">Injecter un message HL7/FHIR</a>
        <a href="/endpoints" class="rounded-xl border border-slate-200 px-3 py-2 hover:bg-blue-50">Configuration des endpoints</a>
        <a href="/admin/ght/{{ ght_context.id }}/namespaces/new" class="rounded-xl border border-slate-200 px-3 py-2 hover:bg-blue-50">Nouvel espace de noms</a>
        <a href="/guide" class="rounded-xl border border-slate-200 px-3 py-2 hover:bg-blue-50">Guide utilisateur (experts)</a>
        <a href="/api-docs" class="rounded-xl border border-slate-200 px-3 py-2 hover:bg-blue-50">Documentation API</a>
      </div>
    </div>
    <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">
      <h3 class="text-base font-semibold text-slate-800">Messages récents</h3>
      {% if message_logs %}
      <ul class="mt-4 space-y-3 text-sm">
        {% for msg in message_logs %}
        <li class="flex items-center justify-between border-b border-slate-100 pb-3">
          <div>
            <p class="font-medium text-slate-700">{{ msg.kind }} — {{ msg.direction|upper }}</p>
            <p class="text-xs text-slate-500">{{ msg.created_at.strftime('%d/%m/%Y %H:%M') if msg.created_at else '' }}</p>
          </div>
          <a href="/messages/{{ msg.id }}" class="text-xs text-blue-600 hover:underline">Voir</a>
        </li>
        {% endfor %}
      </ul>
      {% else %}
      <p class="mt-4 text-sm text-slate-500">Aucun message récemment reçu.</p>
      {% endif %}
    </div>
  </div>
</section>
{% endblock %}
