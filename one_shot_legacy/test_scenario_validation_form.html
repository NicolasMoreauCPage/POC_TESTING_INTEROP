<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Test Validation Sc√©nario</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        form { max-width: 1200px; }
        label { display: block; margin: 10px 0 5px; font-weight: bold; }
        textarea, select { width: 100%; padding: 8px; margin-bottom: 10px; font-family: monospace; font-size: 12px; }
        button { padding: 10px 20px; background: #7c3aed; color: white; border: none; cursor: pointer; border-radius: 4px; }
        button:hover { background: #6d28d9; }
        .info { background: #ede9fe; padding: 15px; margin: 20px 0; border: 1px solid #7c3aed; border-radius: 4px; }
        .example { background: #f3f4f6; padding: 10px; margin: 10px 0; border-left: 4px solid #3b82f6; }
        .example h4 { margin-top: 0; color: #1e40af; }
    </style>
</head>
<body>
    <h1>Test Validation de Sc√©nario IHE PAM</h1>
    
    <div class="info">
        <strong>üìã Instructions :</strong>
        <ol>
            <li>Le serveur FastAPI doit √™tre d√©marr√© : <code>uvicorn app.app:app --reload</code></li>
            <li>Collez plusieurs messages HL7 s√©par√©s par un saut de ligne vide</li>
            <li>Le syst√®me validera :
                <ul>
                    <li>‚úÖ Chaque message individuellement (structure + r√®gles IHE PAM)</li>
                    <li>‚úÖ Les transitions de workflow (A05‚ÜíA01‚ÜíA02‚ÜíA03, etc.)</li>
                    <li>‚úÖ La coh√©rence des identifiants patient/dossier</li>
                    <li>‚úÖ La chronologie des √©v√©nements (timestamps)</li>
                </ul>
            </li>
        </ol>
    </div>

    <form method="post" action="http://127.0.0.1:8000/validation/validate-scenario" id="testForm">
        <label for="scenario_messages">Messages du sc√©nario (s√©parez par saut de ligne vide) :</label>
        <textarea id="scenario_messages" name="scenario_messages" rows="25" required>MSH|^~\&|SRC_APP|SRC_FAC|RECV_APP|RECV_FAC|20240101100000||ADT^A05^ADT_A05|MSG001|P|2.5
EVN|A05|20240101100000
PID|1||PAT123456^^^HOSP||DUPONT^JEAN^PAUL||19800115|M|||123 Rue de la Paix^^PARIS^^75001^FR|||||||123456789
PV1|1|P|PREMED^PRE^1||||DOC123^MARTIN^SOPHIE^DR|||||||||||VIS789^^^HOSP|||||||||||||||||||||||||20240105

MSH|^~\&|SRC_APP|SRC_FAC|RECV_APP|RECV_FAC|20240105090000||ADT^A01^ADT_A01|MSG002|P|2.5
EVN|A01|20240105090000
PID|1||PAT123456^^^HOSP||DUPONT^JEAN^PAUL||19800115|M|||123 Rue de la Paix^^PARIS^^75001^FR|||||||123456789
PV1|1|I|CARDIO^101^A^^^^Building A|28|||DOC123^MARTIN^SOPHIE^DR|||CARDIO||||||||VIS789^^^HOSP|||||||||||||||||||||||||20240105090000

MSH|^~\&|SRC_APP|SRC_FAC|RECV_APP|RECV_FAC|20240107140000||ADT^A02^ADT_A02|MSG003|P|2.5
EVN|A02|20240107140000
PID|1||PAT123456^^^HOSP||DUPONT^JEAN^PAUL||19800115|M|||123 Rue de la Paix^^PARIS^^75001^FR|||||||123456789
PV1|1|I|NEURO^201^B^^^^Building B|28|||DOC456^DURAND^PIERRE^DR|||NEURO||||||||VIS789^^^HOSP|||||||||||||||||||||||||20240107140000

MSH|^~\&|SRC_APP|SRC_FAC|RECV_APP|RECV_FAC|20240110160000||ADT^A03^ADT_A03|MSG004|P|2.5
EVN|A03|20240110160000
PID|1||PAT123456^^^HOSP||DUPONT^JEAN^PAUL||19800115|M|||123 Rue de la Paix^^PARIS^^75001^FR|||||||123456789
PV1|1|I|NEURO^201^B^^^^Building B|28|||DOC456^DURAND^PIERRE^DR|||NEURO||||||||VIS789^^^HOSP|||||||||||||||||||||||||20240110160000</textarea>

        <label for="direction">Direction :</label>
        <select id="direction" name="direction">
            <option value="inbound" selected>Inbound (r√©ception)</option>
            <option value="outbound">Outbound (√©mission)</option>
        </select>

        <label for="profile">Profil de validation :</label>
        <select id="profile" name="profile">
            <option value="IHE_PAM_FR" selected>IHE PAM France</option>
            <option value="IHE_PAM">IHE PAM International</option>
        </select>

        <button type="submit">üîç Valider le sc√©nario</button>
    </form>

    <div class="example">
        <h4>üí° Exemples de sc√©narios √† tester :</h4>
        
        <p><strong>1. Parcours complet valide</strong> (pr√©-rempli ci-dessus) :<br>
        A05 (pr√©-admission) ‚Üí A01 (admission) ‚Üí A02 (transfert) ‚Üí A03 (sortie)</p>
        
        <p><strong>2. Workflow invalide</strong> (commence par A02, pas initial) :<br>
        <small>Remplacez le contenu par un seul message A02</small></p>
        
        <p><strong>3. Transition invalide</strong> (A05‚ÜíA03 sans admission) :<br>
        <small>A05 puis directement A03 (impossible, pas d'hospitalisation)</small></p>
        
        <p><strong>4. Patients diff√©rents</strong> (incoh√©rence) :<br>
        <small>Deux messages avec PID-3 diff√©rents (PAT111 puis PAT222)</small></p>
        
        <p><strong>5. Chronologie invers√©e</strong> (timestamps d√©sordonn√©s) :<br>
        <small>Premier message avec date 2024-01-05, deuxi√®me avec 2024-01-01</small></p>
    </div>

    <script>
        document.getElementById('testForm').addEventListener('submit', function(e) {
            const messages = document.getElementById('scenario_messages').value;
            const msgCount = messages.split('MSH|').length - 1;
            console.log('Soumission du sc√©nario...');
            console.log('Nombre de messages:', msgCount);
            console.log('Longueur totale:', messages.length, 'caract√®res');
        });
    </script>
</body>
</html>
